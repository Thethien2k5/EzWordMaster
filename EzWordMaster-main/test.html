<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>·ª®ng d·ª•ng h·ªçc t·ª´ v·ª±ng (Anh-Vi·ªát)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .tab-active {
            border-color: #3b82f6;
            color: #3b82f6;
            font-weight: 600;
        }
        .feedback {
            transition: all 0.3s ease-in-out;
        }
        .correct {
            color: #16a34a; /* green-600 */
        }
        .incorrect {
            color: #dc2626; /* red-600 */
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800">

    <div class="container mx-auto p-4 md:p-8 max-w-2xl">
        <header class="text-center mb-8">
            <h1 class="text-3xl md:text-4xl font-bold text-blue-600">Vocabulary Builder</h1>
            <p class="text-gray-600 mt-2">Tra c·ª©u, d·ªãch, l∆∞u v√† √¥n t·∫≠p t·ª´ v·ª±ng ti·∫øng Anh m·ªói ng√†y.</p>
        </header>

        <!-- Thanh ƒëi·ªÅu h∆∞·ªõng (Tabs) -->
        <div class="mb-6 border-b border-gray-200">
            <nav class="flex -mb-px space-x-6" aria-label="Tabs">
                <button id="tab-search" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm tab-active">
                    üîç Tra t·ª´ & D·ªãch
                </button>
                <button id="tab-review" class="whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm text-gray-500 hover:text-gray-700 hover:border-gray-300">
                    üìö √în t·∫≠p (<span id="review-count">0</span>)
                </button>
            </nav>
        </div>

        <!-- Ph·∫ßn n·ªôi dung ch√≠nh -->
        <main>
            <!-- Giao di·ªán tra t·ª´ -->
            <div id="search-section">
                <div class="bg-white p-6 rounded-lg shadow-md">
                    <form id="search-form" class="flex flex-col sm:flex-row gap-3">
                        <input type="text" id="word-input" placeholder="Nh·∫≠p t·ª´ c·∫ßn tra..." class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150" required>
                        <button type="submit" class="w-full sm:w-auto bg-blue-600 text-white font-semibold px-6 py-2 rounded-md hover:bg-blue-700 transition duration-150">
                            T√¨m ki·∫øm
                        </button>
                    </form>
                </div>
                <div id="result-container" class="mt-6">
                    <!-- K·∫øt qu·∫£ t√¨m ki·∫øm s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                </div>
            </div>

            <!-- Giao di·ªán √¥n t·∫≠p -->
            <div id="review-section" class="hidden">
                <div id="review-list" class="space-y-4">
                    <!-- Danh s√°ch t·ª´ c·∫ßn √¥n t·∫≠p s·∫Ω ƒë∆∞·ª£c hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                </div>
                 <div id="empty-review-list" class="text-center bg-white p-8 rounded-lg shadow-md">
                    <p class="text-gray-500">Danh s√°ch √¥n t·∫≠p c·ªßa b·∫°n ƒëang tr·ªëng.</p>
                    <p class="text-gray-500 mt-2">H√£y b·∫Øt ƒë·∫ßu b·∫±ng c√°ch t√¨m ki·∫øm v√† l∆∞u l·∫°i nh·ªØng t·ª´ m·ªõi nh√©!</p>
                </div>
            </div>
        </main>
        
        <!-- Th√¥ng b√°o nhanh (Toast) -->
        <div id="toast" class="fixed bottom-5 right-5 bg-green-500 text-white py-2 px-4 rounded-lg shadow-xl translate-x-[200%] transition-transform duration-500">
            ƒê√£ l∆∞u t·ª´ th√†nh c√¥ng!
        </div>

    </div>

    <script>
        // --- KHAI B√ÅO BI·∫æN V√Ä L·∫§Y C√ÅC ELEMENT T·ª™ DOM ---
        const searchTab = document.getElementById('tab-search');
        const reviewTab = document.getElementById('tab-review');
        const searchSection = document.getElementById('search-section');
        const reviewSection = document.getElementById('review-section');
        const searchForm = document.getElementById('search-form');
        const wordInput = document.getElementById('word-input');
        const resultContainer = document.getElementById('result-container');
        const reviewListContainer = document.getElementById('review-list');
        const reviewCount = document.getElementById('review-count');
        const emptyReviewListMessage = document.getElementById('empty-review-list');
        const toast = document.getElementById('toast');

        // State: M·∫£ng ch·ª©a danh s√°ch c√°c t·ª´ c·∫ßn √¥n t·∫≠p
        let reviewList = [];

        // --- H√ÄM X·ª¨ L√ù CH√çNH ---

        // H√†m chuy·ªÉn tab
        function switchTab(tab) {
            if (tab === 'search') {
                searchTab.classList.add('tab-active');
                reviewTab.classList.remove('tab-active');
                searchSection.classList.remove('hidden');
                reviewSection.classList.add('hidden');
            } else {
                reviewTab.classList.add('tab-active');
                searchTab.classList.remove('tab-active');
                reviewSection.classList.remove('hidden');
                searchSection.classList.add('hidden');
                renderReviewList(); 
            }
        }

        // === THAY ƒê·ªîI: H√†m x·ª≠ l√Ω khi t√¨m ki·∫øm t·ª´, g·ªçi 2 API c√πng l√∫c ===
        async function handleSearch(event) {
            event.preventDefault();
            const word = wordInput.value.trim().toLowerCase();
            if (!word) return;

            resultContainer.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md text-center">
                    <p class="animate-pulse">ƒêang t√¨m ki·∫øm v√† d·ªãch...</p>
                </div>`;

            try {
                // T·∫°o 2 promise ƒë·ªÉ g·ªçi API ƒë·ªìng th·ªùi, gi√∫p tƒÉng t·ªëc ƒë·ªô
                const dictionaryPromise = fetch(`https://api.dictionaryapi.dev/api/v2/entries/en/${word}`);
                const translationPromise = fetch(`https://api.mymemory.translated.net/get?q=${word}&langpair=en|vi`);

                // Ch·ªù c·∫£ 2 promise ho√†n th√†nh
                const [dictResponse, transResponse] = await Promise.all([dictionaryPromise, translationPromise]);

                if (!dictResponse.ok) {
                    throw new Error('Kh√¥ng t√¨m th·∫•y ƒë·ªãnh nghƒ©a cho t·ª´ n√†y.');
                }
                 if (!transResponse.ok) {
                    throw new Error('D·ªãch v·ª• d·ªãch thu·∫≠t g·∫∑p l·ªói.');
                }
                
                const dictData = await dictResponse.json();
                const transData = await transResponse.json();

                const wordData = dictData[0];
                const translation = transData.responseData.translatedText || 'Kh√¥ng th·ªÉ d·ªãch.';
                
                displayResult(wordData, translation);

            } catch (error) {
                resultContainer.innerHTML = `
                    <div class="bg-white p-6 rounded-lg shadow-md text-center text-red-600">
                        <p><strong>L·ªói:</strong> ${error.message}</p>
                        <p class="text-sm text-gray-500 mt-1">Vui l√≤ng ki·ªÉm tra l·∫°i t·ª´ ho·∫∑c th·ª≠ l·∫°i sau.</p>
                    </div>`;
            }
        }
        
        // === THAY ƒê·ªîI: H√†m hi·ªÉn th·ªã k·∫øt qu·∫£ t√¨m ki·∫øm, th√™m ph·∫ßn d·ªãch nghƒ©a ===
        function displayResult(wordData, translation) {
            const word = wordData.word;
            const phonetic = wordData.phonetic || (wordData.phonetics.find(p => p.text)?.text || '');
            const meaning = wordData.meanings[0].definitions[0].definition;
            const example = wordData.meanings[0].definitions[0].example || 'Kh√¥ng c√≥ v√≠ d·ª•.';

            resultContainer.innerHTML = `
                <div class="bg-white p-6 rounded-lg shadow-md animate-fade-in">
                    <div class="flex justify-between items-start">
                        <div>
                            <h2 class="text-2xl font-bold text-gray-900">${word}</h2>
                            <p class="text-gray-500">${phonetic}</p>
                        </div>
                        <button class="save-btn bg-green-500 text-white font-bold py-2 px-4 rounded-md hover:bg-green-600 transition" 
                                data-word="${word}" 
                                data-meaning="${meaning}"
                                data-translation="${translation}">
                            L∆∞u
                        </button>
                    </div>
                    <div class="mt-4 pt-4 border-t space-y-2">
                        <p><strong>D·ªãch nghƒ©a:</strong> <span class="text-blue-600 font-semibold">${translation}</span></p>
                        <p><strong>ƒê·ªãnh nghƒ©a (EN):</strong> ${meaning}</p>
                        <p><strong>V√≠ d·ª•:</strong> <em class="text-gray-600">"${example}"</em></p>
                    </div>
                </div>`;
        }

        // === THAY ƒê·ªîI: H√†m l∆∞u t·ª´, th√™m c·∫£ nghƒ©a d·ªãch ===
        function saveWord(word, meaning, translation) {
            const isExisting = reviewList.some(item => item.word.toLowerCase() === word.toLowerCase());
            if (isExisting) {
                showToast('T·ª´ n√†y ƒë√£ c√≥ trong danh s√°ch!', 'bg-yellow-500');
                return;
            }

            // L∆∞u c·∫£ 3 th√¥ng tin
            reviewList.push({ word, meaning, translation });
            saveToLocalStorage();
            updateReviewCount();
            showToast('ƒê√£ l∆∞u t·ª´ th√†nh c√¥ng!', 'bg-green-500');
        }
        
        // H√†m hi·ªÉn th·ªã th√¥ng b√°o nhanh (toast)
        function showToast(message, bgColor) {
            toast.textContent = message;
            toast.className = `fixed bottom-5 right-5 text-white py-2 px-4 rounded-lg shadow-xl transition-transform duration-500 ${bgColor} translate-x-0`;
            setTimeout(() => {
                toast.classList.add('translate-x-[200%]');
            }, 3000);
        }

        // H√†m v·∫Ω/c·∫≠p nh·∫≠t danh s√°ch √¥n t·∫≠p
        function renderReviewList() {
            reviewListContainer.innerHTML = ''; 
            if(reviewList.length === 0){
                emptyReviewListMessage.classList.remove('hidden');
                reviewListContainer.classList.add('hidden');
            } else {
                emptyReviewListMessage.classList.add('hidden');
                reviewListContainer.classList.remove('hidden');
                reviewList.forEach((item, index) => {
                    const reviewCard = document.createElement('div');
                    reviewCard.className = 'bg-white p-5 rounded-lg shadow-md';
                    reviewCard.innerHTML = `
                        <div class="flex justify-between items-center">
                            <h3 class="text-xl font-semibold">${item.word}</h3>
                            <button class="delete-btn text-gray-400 hover:text-red-500 transition" data-index="${index}">‚úñ</button>
                        </div>
                        <div class="mt-3 flex flex-col sm:flex-row gap-2">
                            <input type="text" placeholder="Nh·∫≠p nghƒ©a ti·∫øng Vi·ªát..." class="review-input w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500">
                            <button class="check-btn w-full sm:w-auto bg-gray-600 text-white font-semibold px-5 py-2 rounded-md hover:bg-gray-700 transition" data-index="${index}">Ki·ªÉm tra</button>
                        </div>
                        <div class="feedback mt-2 text-sm h-5"></div>
                    `;
                    reviewListContainer.appendChild(reviewCard);
                });
            }
        }
        
        // === THAY ƒê·ªîI: H√†m ki·ªÉm tra nghƒ©a, so s√°nh v·ªõi nghƒ©a ti·∫øng Vi·ªát ===
        function checkMeaning(index, userInput) {
            // L·∫•y ra c√¢u tr·∫£ l·ªùi ƒë√∫ng l√† nghƒ©a ti·∫øng Vi·ªát
            const correctAnswer = reviewList[index].translation;
            const feedbackEl = document.querySelectorAll('.feedback')[index];
            
            if (userInput.trim().toLowerCase() === correctAnswer.trim().toLowerCase()) {
                feedbackEl.textContent = 'üéâ Ch√≠nh x√°c!';
                feedbackEl.className = 'feedback mt-2 text-sm h-5 correct';
            } else {
                feedbackEl.textContent = `üò• Sai r·ªìi. Nghƒ©a ƒë√∫ng l√†: "${correctAnswer}"`;
                 feedbackEl.className = 'feedback mt-2 text-sm h-5 incorrect';
            }
        }
        
        // H√†m x√≥a t·ª´ kh·ªèi danh s√°ch
        function deleteWord(index) {
            reviewList.splice(index, 1);
            saveToLocalStorage();
            renderReviewList();
            updateReviewCount();
        }

        // --- L∆ØU TR·ªÆ LOCALSTORAGE ---
        function saveToLocalStorage() {
            localStorage.setItem('englishReviewList', JSON.stringify(reviewList));
        }

        function loadFromLocalStorage() {
            const storedList = localStorage.getItem('englishReviewList');
            if (storedList) {
                reviewList = JSON.parse(storedList);
            }
        }
        
        // C·∫≠p nh·∫≠t s·ªë l∆∞·ª£ng t·ª´ trong tab √¥n t·∫≠p
        function updateReviewCount() {
            reviewCount.textContent = reviewList.length;
        }


        // --- G·∫ÆN C√ÅC S·ª∞ KI·ªÜN ---

        searchTab.addEventListener('click', () => switchTab('search'));
        reviewTab.addEventListener('click', () => switchTab('review'));
        
        searchForm.addEventListener('submit', handleSearch);

        // === THAY ƒê·ªîI: S·ª± ki·ªán n√∫t "L∆∞u", l·∫•y th√™m data-translation ===
        resultContainer.addEventListener('click', (event) => {
            if (event.target.classList.contains('save-btn')) {
                const { word, meaning, translation } = event.target.dataset;
                saveWord(word, meaning, translation);
            }
        });
        
        reviewListContainer.addEventListener('click', (event) => {
            const target = event.target;
            const index = target.dataset.index;
            if(!index) return;
            
            if(target.classList.contains('check-btn')) {
                const userInput = target.previousElementSibling.value;
                checkMeaning(index, userInput);
            }
            
            if(target.classList.contains('delete-btn')) {
                deleteWord(index);
            }
        });

        // --- KH·ªûI T·∫†O ·ª®NG D·ª§NG ---
        document.addEventListener('DOMContentLoaded', () => {
            loadFromLocalStorage();
            updateReviewCount();
            switchTab('search'); 
        });

    </script>
</body>
</html>
